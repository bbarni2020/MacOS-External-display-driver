<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeskExtend Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body {
            height: 100%;
            width: 100%;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            background: #000;
            color: #e0e0e0;
            height: 100vh;
            width: 100vw;
            min-height: 100vh;
            min-width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: stretch;
            align-items: stretch;
            overflow: hidden;
            transition: background 0.5s;
        }
        .main {
            flex: 1 1 0;
            min-height: 0;
            min-width: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100vw;
            height: 100vh;
            user-select: none;
        }
        .time {
            font-size: 7vw;
            font-weight: 400;
            letter-spacing: 0.05em;
            margin-bottom: 0.2em;
            color: #b0b0b8;
            opacity: 0.7;
            transition: color 0.5s, opacity 0.5s;
        }
        .date {
            font-size: 1.2vw;
            color: #888ca0;
            font-weight: 400;
            margin-bottom: 2.5em;
            opacity: 0.5;
            transition: color 0.5s, opacity 0.5s;
        }
        .weather {
            display: flex;
            align-items: center;
            gap: 1em;
            font-size: 1.1vw;
            color: #1b5e3c;
            margin-bottom: 2em;
            font-weight: 500;
            opacity: 0.5;
        }
        .weather-icon {
            width: 2vw;
            height: 2vw;
            object-fit: contain;
            filter: grayscale(0.7) brightness(0.7);
        }
        .stats {
            position: fixed;
            left: 50%;
            bottom: 3.5vw;
            transform: translateX(-50%);
            display: flex;
            gap: 1.2vw;
            background: rgba(24,24,28,0.88);
            border-radius: 1.7em 1.7em 2.2em 2.2em/1.7em 1.7em 2.7em 2.7em;
            padding: 0.7em 1.7em 1.1em 1.7em;
            min-height: 38px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.13), 0 1.5px 8px rgba(0,0,0,0.08);
            margin: 0;
            z-index: 20;
            border: 1px solid rgba(255,255,255,0.06);
            backdrop-filter: blur(10px);
            opacity: 0.85;
        }
        .stat {
            min-width: 70px;
            text-align: left;
        }
        .stat-label {
            font-size: 0.8em;
            color: #7a7a8c;
            margin-bottom: 0.2em;
            letter-spacing: 0.04em;
            opacity: 0.7;
        }
        .stat-value {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 0.2em;
            color: #e0e0e0;
            opacity: 0.8;
        }
        .bar {
            background: #19191c;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.2s cubic-bezier(.4,0,.2,1);
        }
        .cpu .bar-fill { background: linear-gradient(90deg, #b97a5b, #a85a5a); }
        .ram .bar-fill { background: linear-gradient(90deg, #3e8e7e, #2e6d5a); }
        .storage .bar-fill { background: linear-gradient(90deg, #3a6e8c, #2a4d6a); }
        .temp .bar-fill { background: linear-gradient(90deg, #a87ab9, #7a5aa8); }
        .internet-status {
            position: fixed;
            top: 2em;
            right: 2em;
            font-size: 1em;
            font-weight: 500;
            color: #ff6b6b;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            background: rgba(30,30,30,0.5);
            border-radius: 1em;
            padding: 0.5em 1.2em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            opacity: 0.7;
        }
        .spotify-widget {
            position: absolute;
            left: 50%;
            bottom: calc(3.5vw + 38px + 50px);
            transform: translateX(-50%) translateY(20px);
            min-width: 220px;
            max-width: 340px;
            background: rgba(30,30,30,0.85);
            border-radius: 1.2em;
            box-shadow: 0 2px 12px rgba(0,0,0,0.10);
            padding: 0.7em 1.2em 0.7em 0.8em;
            display: flex;
            align-items: center;
            gap: 0.8em;
            z-index: 12;
            border: 1px solid rgba(255,255,255,0.06);
            backdrop-filter: blur(8px);
            color: #e0e0e0;
            font-size: 1em;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.35s cubic-bezier(.4,0,.2,1), transform 0.35s cubic-bezier(.4,0,.2,1);
        }
        .spotify-widget.visible {
            opacity: 0.7;
            pointer-events: auto;
            transform: translateX(-50%) translateY(0);
        }
        .spotify-cover {
            width: 36px;
            height: 36px;
            border-radius: 0.5em;
            object-fit: cover;
            background: #18181c;
            filter: grayscale(0.5) brightness(0.8);
        }
        .spotify-info {
            display: flex;
            flex-direction: column;
            gap: 0.2em;
            min-width: 0;
        }
        .spotify-title {
            font-weight: 500;
            font-size: 0.98em;
            color: #e0e0e0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
            opacity: 0.8;
        }
        .spotify-artist {
            font-size: 0.92em;
            color: #888ca0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
            opacity: 0.6;
        }
        .spotify-logo {
            width: 22px;
            height: 22px;
            margin-left: auto;
            opacity: 0.5;
        }
        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(30px);
            }
        }
        #startup-logo span {
            display: inline-block;
            animation: fadeInUp 0.8s ease forwards paused;
            opacity: 0;
            transform: translateY(30px);
            visibility: hidden;
        }
        #startup-logo.animate span {
            animation-play-state: running;
        }
        #startup-logo span:nth-child(1) { animation-delay: 0s; }
        #startup-logo span:nth-child(2) { animation-delay: 0.08s; }
        #startup-logo span:nth-child(3) { animation-delay: 0.16s; }
        #startup-logo span:nth-child(4) { animation-delay: 0.24s; }
        #startup-logo span:nth-child(5) { animation-delay: 0.32s; }
        #startup-logo span:nth-child(6) { animation-delay: 0.4s; }
        #startup-logo span:nth-child(7) { animation-delay: 0.48s; }
        #startup-logo span:nth-child(8) { animation-delay: 0.56s; }
        #startup-logo span:nth-child(9) { animation-delay: 0.64s; }
        #startup-logo span:nth-child(10) { animation-delay: 0.72s; }
        #startup-logo span:nth-child(11) { animation-delay: 0.8s; }
        #startup-overlay {
            opacity: 0;
            transition: opacity 0.35s ease;
        }
        #startup-overlay.visible {
            opacity: 1;
        }
        #startup-overlay::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image: radial-gradient(circle, rgba(255,255,255,0.95) 2px, transparent 2px);
            background-size: 34px 34px;
            opacity: 0.06;
            pointer-events: none;
            z-index: 1;
        }
        #startup-overlay > #startup-logo {
            position: relative;
            z-index: 2;
        }
        body.animating .main {
            display: none;
        }
        @media (max-width: 900px) {
            .time { font-size: 12vw; }
            .date, .weather { font-size: 3vw; }
            .weather-icon { width: 5vw; height: 5vw; }
            .stats { flex-direction: column; gap: 1em; padding: 1em 1.5em; }
            .spotify-widget { max-width: 90vw; font-size: 3vw; padding: 0.7em 1em; }
            .spotify-title, .spotify-artist { max-width: 40vw; }
        }
    </style>
</head>
<body>
    <div id="startup-overlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999;pointer-events:none;display:none;align-items:center;justify-content:center;flex-direction:column;background:#0c140b;color:#fff;">
        <div id="startup-logo" style="font-size:8vw;font-weight:900;color:#fff;letter-spacing:0.02em;text-shadow:0 2px 4px rgba(0,0,0,0.12);">
            <span>W</span><span>e</span><span>l</span><span>c</span><span>o</span><span>m</span><span>e</span> <span>b</span><span>a</span><span>c</span><span>k</span>
        </div>
    </div>
    <div class="main">
        <div class="time" id="time"></div>
        <div class="date" id="date"></div>
        <div class="weather" id="weather">
            <img class="weather-icon" id="weather-icon" src="" alt="" style="display:none;"/>
            <span id="weather-desc"></span>
            <span id="weather-temp"></span>
        </div>
        <div class="spotify-widget" id="spotify-widget">
            <img class="spotify-cover" id="spotify-cover" src="" alt=""/>
            <div class="spotify-info">
                <div class="spotify-title" id="spotify-title"></div>
                <div class="spotify-artist" id="spotify-artist"></div>
            </div>
            <img class="spotify-logo" src="https://upload.wikimedia.org/wikipedia/commons/1/19/Spotify_logo_without_text.svg" alt="Spotify"/>
        </div>
        <div class="stats">
            <div class="stat cpu">
                <div class="stat-label">CPU</div>
                <div class="stat-value"><span id="cpu">0</span>%</div>
                <div class="bar"><div class="bar-fill" id="cpu-bar" style="width: 0%"></div></div>
            </div>
            <div class="stat ram">
                <div class="stat-label">RAM</div>
                <div class="stat-value"><span id="ram">0</span>%</div>
                <div class="bar"><div class="bar-fill" id="ram-bar" style="width: 0%"></div></div>
            </div>
            <div class="stat storage">
                <div class="stat-label">STORAGE</div>
                <div class="stat-value"><span id="storage">0</span>%</div>
                <div class="bar"><div class="bar-fill" id="storage-bar" style="width: 0%"></div></div>
            </div>
            <div class="stat temp">
                <div class="stat-label">TEMP</div>
                <div class="stat-value"><span id="temp">0</span>°C</div>
                <div class="bar"><div class="bar-fill" id="temp-bar" style="width: 0%"></div></div>
            </div>
        </div>
    </div>
    <div class="internet-status" id="internet-status" style="display:none;">
        <span id="status-text">Offline</span>
    </div>
    <script>
        function playStartupAnimation() {
            const overlay = document.getElementById('startup-overlay');
            const logo = document.getElementById('startup-logo');
            const body = document.body;
            overlay.style.display = 'flex';
            requestAnimationFrame(() => {
                overlay.classList.add('visible');
            });
            body.classList.add('animating');
            setTimeout(() => {
                logo.classList.add('animate');
                const spans = logo.querySelectorAll('span');
                spans.forEach(span => span.style.visibility = 'visible');
            }, 200);
            setTimeout(() => {
                const spans = logo.querySelectorAll('span');
                spans.forEach((span, index) => {
                    setTimeout(() => {
                        span.style.animation = 'fadeOut 0.5s ease forwards';
                    }, (spans.length - 1 - index) * 100);
                });
                const fadeOutDuration = 500;
                const maxDelay = (spans.length - 1) * 100;
                const overlayTransition = 350;
                setTimeout(() => {
                    overlay.classList.remove('visible');
                    setTimeout(() => {
                        overlay.style.display = 'none';
                        body.classList.remove('animating');
                        logo.classList.remove('animate');
                        spans.forEach(span => {
                            span.style.animation = '';
                            span.style.visibility = 'hidden';
                        });
                    }, overlayTransition);
                }, maxDelay + fadeOutDuration + 50);
            }, 3200);
        }

        // Listen for /start-status endpoint
        async function pollStartStatus() {
            try {
                const resp = await fetch('/start-status');
                if (resp.ok) {
                    const data = await resp.json();
                    if (data.play) playStartupAnimation();
                }
            } catch (e) {}
            setTimeout(pollStartStatus, 1500);
        }
        pollStartStatus();
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {hour12: false, hour: '2-digit', minute: '2-digit'});
            document.getElementById('time').textContent = timeString;
            document.getElementById('date').textContent = now.toLocaleDateString('en-US', {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'});
        }
        function updateStats() {
            fetch('/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('cpu').textContent = data.cpu;
                    document.getElementById('cpu-bar').style.width = data.cpu + '%';
                    document.getElementById('ram').textContent = data.ram;
                    document.getElementById('ram-bar').style.width = data.ram + '%';
                    document.getElementById('storage').textContent = data.storage;
                    document.getElementById('storage-bar').style.width = data.storage + '%';
                    document.getElementById('temp').textContent = data.temp;
                    document.getElementById('temp-bar').style.width = Math.min(data.temp / 80 * 100, 100) + '%';
                });
        }
        function checkInternet() {
            fetch('https://www.google.com/favicon.ico', { mode: 'no-cors' })
                .then(() => {
                    document.getElementById('internet-status').style.display = 'none';
                })
                .catch(() => {
                    document.getElementById('internet-status').style.display = '';
                    document.getElementById('status-text').textContent = 'Offline';
                });
        }
        function updateWeather() {
            fetch('/weather')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('weather-temp').textContent = data.temp ? (data.temp + '°C') : '';
                    document.getElementById('weather-desc').textContent = data.desc || '';
                    const icon = document.getElementById('weather-icon');
                    if (data.icon) {
                        icon.src = data.icon;
                        icon.style.display = 'inline-block';
                    } else {
                        icon.style.display = 'none';
                    }
                })
                .catch(() => {
                    document.getElementById('weather-desc').textContent = 'Weather unavailable';
                    document.getElementById('weather-icon').style.display = 'none';
                    document.getElementById('weather-temp').textContent = '';
                });
        }
        function updateSpotify() {
            fetch('/spotify')
                .then(r => r.json())
                .then(data => {
                    const widget = document.getElementById('spotify-widget');
                    if (data && data.title) {
                        document.getElementById('spotify-title').textContent = data.title;
                        document.getElementById('spotify-artist').textContent = data.artist;
                        document.getElementById('spotify-cover').src = data.cover || '';
                        widget.classList.add('visible');
                    } else {
                        widget.classList.remove('visible');
                    }
                })
                .catch(() => {
                    document.getElementById('spotify-widget').classList.remove('visible');
                });
        }
        updateTime();
        updateStats();
        checkInternet();
        updateWeather();
        updateSpotify();
        setInterval(updateTime, 1000);
        setInterval(updateStats, 5000);
        setInterval(checkInternet, 10000);
        setInterval(updateWeather, 1800000);
        setInterval(updateSpotify, 5000);
    </script>
</body>
</html>